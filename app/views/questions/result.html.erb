<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
  </head>
  <body>
    <%= image_tag "logo2.png"%>
    <script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
    <div class="question_title">
      質問：<%= @question.body %>
    </div>
    <div class="center">
      <b class="answer_font">
        <%= @yes_count %></b><small class="number_of_participant_font">/<%= @answers_count %>
      </small>
    </div>
    <div class="center">
      <%= link_to "次の質問へ", controller: 'questions', action: 'show', id: '0'  %>
    </div>
    <%= javascript_tag do %>
      yesCount = <%= raw @yes_count %>;
      answersCount = <%= raw @answers_count %>;
    <% end %>
    <script>
      var max = answersCount;
      var maxhalf;
      var maxquad;
      var maxend;
      var min = 0;
      var minhalf;
      var minquad;
      var minend;
      var speed = 100;
      var cnt = 0;
      var ran;
      var ranbefore = 0;
      function changenumber () {
        ran = Math.round(min + (Math.random() * (max - min)));
        if ((ran === ranbefore) && (ran !== 0)) {
          ran--;
        } else if ((ran === ranbefore) && (ran === 0)) {
          ran = 1;
        }
        document.getElementsByTagName('b')[0].firstChild.nodeValue = ran;
        ranbefore = ran;
      }
      minhalf = yesCount / 2;
      maxhalf = answersCount / 2 + minhalf;
      minquad = 3 * (yesCount / 4);
      maxquad = answersCount / 4 + minquad;
      minend = 7 * (yesCount / 8);
      maxend = answersCount / 8 + minend;
      $(function () {
        var setTimer = setInterval(function () {
          changenumber();
          if (cnt >= 25 && cnt < 50) {
            speed = 200;
            max = maxhalf;
            min = minhalf;
          } else if (cnt >= 50 && cnt < 65) {
            speed = 500;
            max = maxquad;
            min = minquad;
          } else if (cnt >= 65 && cnt < 80) {
            speed = 1000;
            max = maxend;
            min = minend;
          } else if (cnt >= 80) {
            clearInterval(setTimer);
            document.getElementsByTagName('b')[0].firstChild.nodeValue = yesCount;
          }
          cnt++;
        }, speed);
      });
    </script>
  </body>
</html>
